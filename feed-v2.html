<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="Permissions-Policy" content="autoplay=(self), encrypted-media=(self), fullscreen=(self), picture-in-picture=(self)" />
		<title>AI Feed - undressly.app</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<style>
			:root {
				--feed-width: 294px;
				--feed-height: 244px;
			}

			html,
			body {
				margin: 0;
				padding: 0;
				overflow: hidden;
				background: #000000;
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
				height: 100%;
			}

            
			.feed-container {
				width: var(--feed-width);
				height: var(--feed-height);
				background: #000000;
				border-radius: 12px;
				overflow: hidden;
				position: relative;
				display: flex;
				flex-direction: column;
				margin: 3px;
				border: 1px solid rgba(255, 255, 255, 0.1);
				touch-action: none;
				-webkit-touch-callout: none;
				-webkit-user-select: none;
				user-select: none;
			}

			.feed-scroll-area {
				flex: 1;
				overflow: hidden;
				scroll-behavior: smooth;
				scrollbar-width: none;
				-ms-overflow-style: none;
				touch-action: none;
				-webkit-touch-callout: none;
			}

			.feed-scroll-area::-webkit-scrollbar {
				display: none;
			}

			.feed-item {
				position: relative;
				width: 100%;
				height: var(--feed-height);
				display: flex;
				flex-direction: column;
				background: #000000;
				overflow: hidden;
			}

			.feed-media {
				position: relative;
				flex: 1;
				display: flex;
				align-items: center;
				justify-content: center;
				background: linear-gradient(45deg, #1a1a1a, #2a1a2a);
				overflow: hidden;
				cursor: pointer;
			}

			.feed-video,
			.feed-image {
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				width: 100%;
				height: 100%;
				object-fit: cover;
				object-position: center center;
				background: #1a1a1a;
			}

			.feed-video {
				cursor: pointer;
			}

			.video-placeholder {
				width: 100%;
				height: 100%;
				background: linear-gradient(135deg, #ec4899 0%, #f472b6 50%, #8b5cf6 100%);
				display: flex;
				align-items: center;
				justify-content: center;
				color: white;
				font-size: 14px;
				font-weight: 600;
				text-align: center;
				flex-direction: column;
				gap: 8px;
			}

			.video-icon {
				font-size: 24px;
			}

			.feed-overlay {
				position: absolute;
				bottom: 0;
				left: 0;
				right: 0;
				background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
				padding: 16px 12px 12px;
				color: white;
			}

			.character-info {
				display: flex;
				align-items: center;
				gap: 8px;
				margin-bottom: 4px;
			}

			.character-avatar {
				width: 20px;
				height: 20px;
				border-radius: 50%;
				background: linear-gradient(45deg, #ec4899, #f472b6);
				display: flex;
				align-items: center;
				justify-content: center;
				color: white;
				font-size: 9px;
				font-weight: bold;
				flex-shrink: 0;
			}

			.character-name {
				font-size: 11px;
				font-weight: 600;
				color: white;
			}

			.character-description {
				font-size: 10px;
				color: rgba(255, 255, 255, 0.8);
				line-height: 1.3;
				margin-bottom: 4px;
				white-space: nowrap;
				overflow: hidden;
				text-overflow: ellipsis;
				max-width: 100%;
			}

			.action-bar {
				display: flex;
				align-items: center;
				gap: 8px;
			}

			.action-item {
				display: flex;
				align-items: center;
				gap: 3px;
				font-size: 10px;
				color: rgba(255, 255, 255, 0.9);
				cursor: pointer;
				transition: transform 0.2s;
			}

			.action-item:hover {
				transform: scale(1.1);
			}

			.love-icon {
				color: #ec4899;
				font-size: 14px;
			}

			.user-tag {
				color: rgba(255, 255, 255, 0.7);
				font-size: 10px;
				font-weight: 500;
			}

			.clickable-element {
				cursor: pointer;
				transition: opacity 0.2s;
			}

			.clickable-element:hover {
				opacity: 0.8;
			}

			/* Popup overlay styles - matching main feed */
			.popup-overlay {
				position: absolute;
				top: -3px;
				left: -3px;
				right: -3px;
				bottom: -3px;
				background: rgba(0, 0, 0, 0.6);
				display: none;
				align-items: center;
				justify-content: center;
				animation: fadeIn 0.3s ease-out;
				z-index: 1000;
				backdrop-filter: blur(2px);
				border-radius: 12px;
			}

			.popup-overlay.show {
				display: flex;
			}

			.popup-content {
				background: linear-gradient(135deg, rgba(26, 26, 26, 0.9) 0%, rgba(42, 26, 42, 0.9) 100%);
				border-radius: 16px;
				padding: 24px 20px;
				text-align: center;
				border: 1px solid rgba(236, 72, 153, 0.3);
				max-width: 240px;
				box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
				backdrop-filter: blur(8px);
			}

			.popup-title {
				color: white;
				font-size: 16px;
				font-weight: 700;
				margin-bottom: 8px;
				background: linear-gradient(45deg, #ec4899, #f472b6);
				-webkit-background-clip: text;
				-webkit-text-fill-color: transparent;
				background-clip: text;
			}

			.popup-subtitle {
				color: rgba(255, 255, 255, 0.8);
				font-size: 12px;
				margin-bottom: 20px;
				line-height: 1.4;
			}

			.popup-button {
				background: linear-gradient(45deg, #ec4899, #f472b6);
				color: white;
				border: none;
				border-radius: 12px;
				padding: 12px 24px;
				font-size: 13px;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.2s;
				width: 100%;
				box-shadow: 0 4px 16px rgba(236, 72, 153, 0.4);
			}

			.popup-button:hover {
				transform: translateY(-2px);
				box-shadow: 0 6px 20px rgba(236, 72, 153, 0.6);
			}

			@keyframes fadeIn {
				from {
					opacity: 0;
					transform: scale(0.9);
				}
				to {
					opacity: 1;
					transform: scale(1);
				}
			}

			/* Feed header with logo */
			.feed-header {
				position: absolute;
				bottom: 12px;
				right: 12px;
				z-index: 100;
				display: flex;
				align-items: center;
				gap: 8px;
				cursor: pointer;
				transition: all 0.2s;
				height: 20px;
			}

			.feed-header:hover {
				transform: scale(1.05);
			}

			.feed-icon {
				width: 16px;
				height: 16px;
			}

			.feed-logo {
				font-size: 12px;
				font-weight: 700;
				letter-spacing: -0.3px;
			}

			.feed-logo .gradient-text {
				background: linear-gradient(45deg, #ec4899, #f472b6, #f9a8d4, #fce7f3);
				-webkit-background-clip: text;
				-webkit-text-fill-color: transparent;
				background-clip: text;
			}

			.feed-logo .white-text {
				color: white;
				font-weight: 400;
			}

			/* Swipe indicator animation */
			.swipe-indicator {
				position: absolute;
				bottom: 80px;
				left: 50%;
				transform: translateX(-50%);
				z-index: 100;
				display: flex;
				flex-direction: column;
				align-items: center;
				gap: 8px;
				animation: swipeHint 3s ease-in-out;
				pointer-events: none;
			}

			.swipe-text {
				color: white;
				font-size: 11px;
				font-weight: 500;
				text-shadow: 0 2px 8px rgba(0, 0, 0, 0.8);
				opacity: 0.9;
				text-align: center;
				max-width: 250px;
			}

			.swipe-arrow {
				width: 24px;
				height: 24px;
				border: 2px solid white;
				border-radius: 50%;
				display: flex;
				align-items: center;
				justify-content: center;
				background: rgba(0, 0, 0, 0.6);
				backdrop-filter: blur(4px);
				box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
			}

			.swipe-arrow::after {
				content: 'â†“';
				color: white;
				font-size: 14px;
				font-weight: bold;
				animation: bounceArrow 1s ease-in-out infinite;
			}

			@keyframes swipeHint {
				0% {
					opacity: 0;
					transform: translateX(-50%) translateY(20px);
				}
				15% {
					opacity: 1;
					transform: translateX(-50%) translateY(0);
				}
				85% {
					opacity: 1;
					transform: translateX(-50%) translateY(0);
				}
				100% {
					opacity: 0;
					transform: translateX(-50%) translateY(-20px);
				}
			}

			@keyframes bounceArrow {
				0%,
				100% {
					transform: translateY(0);
				}
				50% {
					transform: translateY(4px);
				}
			}

			@keyframes pulseText {
				0%,
				100% {
					opacity: 1;
					transform: scale(1);
					color: white;
				}
				50% {
					opacity: 0.9;
					transform: scale(1.05);
					color: #ec4899;
				}
			}

			.pulse-cta {
				display: inline-block;
				animation: pulseText 1s ease-in-out infinite;
				font-weight: 600;
			}

			/* Hide indicator after first interaction */
			.swipe-indicator.hidden {
				display: none;
			}
		</style>
	</head>
	<body>
		<div class="feed-container" id="feedContainer">
			<!-- Feed å¤´éƒ¨å¸¦ logo -->
			<div class="feed-header" id="feedHeader">
				<div class="feed-logo"><span class="gradient-text">undressly</span><span class="white-text">.app</span></div>
			</div>

			<div class="feed-scroll-area" id="feedScrollArea">
				<!-- Feed é¡¹ç›®å°†åŠ¨æ€ç”Ÿæˆ -->
			</div>

			<!-- æ»‘åŠ¨æŒ‡ç¤ºå™¨ -->
			<!-- <div class="swipe-indicator" id="swipeIndicator">
				<div class="swipe-text"><span class="pulse-cta">New content dropped!</span><br />Swipe to explore!</div>
				<div class="swipe-arrow"></div>
			</div> -->

			<!-- å¼¹çª—è¦†ç›–å±‚ -->
			<div class="popup-overlay" id="popupOverlay">
				<div class="popup-content">
					<div class="popup-title">Continue to Full Feed</div>
					<div class="popup-subtitle">Explore unlimited AI sluts at undressly.app</div>
					<button class="popup-button" id="popupButton">Join Now â†’</button>
				</div>
			</div>
		</div>

		<script>
			;(function () {
				// è·å– URL å‚æ•°
				const urlParams = new URLSearchParams(window.location.search)
				const site = urlParams.get('site') || 'demo'
				const ref = urlParams.get('ref') || site
				const variant = urlParams.get('variant') || 'i-feed-v2'
				const widthParam = urlParams.get('width') || urlParams.get('w')
				const heightParam = urlParams.get('height') || urlParams.get('h')
                const utm_content = urlParams.get('content') || ''

				// è§†é¢‘è¿½è¸ª
				let videosViewed = new Set([0]) // ä»ç¬¬ä¸€ä¸ªè§†é¢‘å·²è§‚çœ‹å¼€å§‹
				let hasShownPopup = false
				let currentVideoIndex = 0
				let isMuted = true
				let hasInteracted = false
				let isNavigating = false
				let lastNavigationTime = 0
				let dynamicFeedHeight = null
				let dynamicFeedWidth = null

				function parseSizeParam(value, fallback) {
					if (!value) return fallback
					const trimmed = value.trim().toLowerCase()
					if (trimmed.endsWith('px') || trimmed.endsWith('%') || trimmed.endsWith('vh') || trimmed.endsWith('vw')) {
						return trimmed
					}
					const numeric = parseFloat(trimmed)
					if (Number.isFinite(numeric) && numeric > 0) {
						return `${numeric}px`
					}
					return fallback
				}

				function applyDynamicSize() {
					const computedWidth = parseSizeParam(widthParam, '294px')
					const computedHeight = parseSizeParam(heightParam, '244px')

					dynamicFeedWidth = computedWidth.endsWith('px') ? parseFloat(computedWidth) : null
					dynamicFeedHeight = computedHeight.endsWith('px') ? parseFloat(computedHeight) : null

					document.documentElement.style.setProperty('--feed-width', computedWidth)
					document.documentElement.style.setProperty('--feed-height', computedHeight)

					console.log('ğŸ“ åº”ç”¨åŠ¨æ€å°ºå¯¸:', { computedWidth, computedHeight })
				}

				// Feed æ•°æ®ï¼ˆæ¥è‡ª CSVï¼‰
				const allFeedItems = [
					{
						id: 1,
						handle: 'undress',
						character: {
							name: 'Zoey',
							avatar: 'Z',
							description: 'You walk in on your step sister touching herself.',
							username: '@anon_111fa2b5',
						},
						videoFile: '/resources/images/d49b35c1dcf0448bfcca41365e42ae7a.mp4',
						avatarFile: 'zoey-avatar.avif',
						loves: '10k',
						photosPath: 'photos/zoey-83',
					},

					{
						id: 3,
						handle: 'undressBanner',
						character: {
							name: 'Mina Park',
							avatar: 'M',
							description: 'The new girl who just moved next door.',
							username: '@anon_f11bedfd',
						},
						imageFile: '/resources/images/728x90_undress_banner.png',
						avatarFile: 'mina-avatar.avif',
						loves: '1.9k',
						photosPath: 'photos/mina-park',
					},
					{
						id: 4,
						handle: 'blowjob',
						character: {
							name: 'Nyx Tether',
							avatar: 'N',
							description: 'Nyx is a woman who has chosen to embark on a unique path of self-discovery',
							username: '@jetstone',
						},
						videoFile: '/resources/images/2e005641da767aebea0ba188e15c68f1.mp4',
						avatarFile: 'nyx-avatar.avif',
						loves: '343',
						photosPath: 'photos/onyx-real-f5h6NkNiRV',
					},
					{
						id: 5,
						handle: 'cumface',
						character: {
							name: 'Lara Quinn',
							avatar: 'L',
							description: 'Your stepsister with a secret fascination for voyeurism and a hidden desire',
							username: '@kurtishurtis',
						},
						videoFile: '/resources/images/a8d1685d968c71a3ad02af254a5e2bb0.mp4',
						avatarFile: 'lara-avatar.avif',
						loves: '507',
						photosPath: 'photos/lara-quinn',
					},
					{
						id: 6,
						handle: 'bannerPm',
						character: {
							name: 'Tylar',
							avatar: 'T',
							description: 'Your snowbunny GF is about to turn your world upside down',
							username: '@daddykelli',
						},
						videoFile: '/resources/images/23ecf10f059a63961af5b16844c877ea.mp4',
						avatarFile: 'tylar-avatar.avif',
						loves: '1.6k',
						photosPath: 'photos/tylar',
					},
					// {
					// 	id: 7,
					// 	handle: 'genie',
					// 	character: {
					// 		name: 'Genie',
					// 		avatar: 'G',
					// 		description: 'Seductive Arab Genie that grants me any wish',
					// 		username: '@hardjohnson',
					// 	},
					// 	videoFile: 'genie-optimized.mp4',
					// 	avatarFile: 'genie-avatar.avif',
					// 	loves: '1.3k',
					// 	photosPath: 'photos/genie',
					// },
				]

				// åˆå§‹åŒ– feed é¡¹ç›®ï¼ˆå°†åœ¨ CSV åŠ è½½åå¡«å……ï¼‰
				let feedItems = []

				// ç”Ÿæˆ feed å†…å®¹
				function generateFeedContent() {
					const feedScrollArea = document.getElementById('feedScrollArea')

					// æ¸…é™¤æ‰€æœ‰ç°æœ‰å†…å®¹ï¼ˆåŒ…æ‹¬ç¡¬ç¼–ç çš„è§†é¢‘ï¼‰ï¼Œç¡®ä¿æ¯æ¬¡éƒ½æ˜¯å…¨æ–°éšæœº
					feedScrollArea.innerHTML = ''

					feedItems.forEach((item, index) => {
						const feedItem = document.createElement('div')
						feedItem.className = 'feed-item'
						feedItem.dataset.index = index

						let mediaMarkup = ''

						if (item.videoFile) {
							const videoPath = `https://cdn.lovepal.net${item.videoFile}`
							mediaMarkup = `
                                <div class="feed-media">
                                    <div class="video-placeholder" id="placeholder-${index}">
                                        <div class="video-icon">ğŸ¬</div>
                                        <div>AI Video Content</div>
                                    </div>
                                    <video 
                                        class="feed-video" 
                                        id="video-${index}"
                                        loop
                                        muted
                                        playsinline
                                        preload="metadata"
                                        style="display: none;"
                                        poster=""
                                        disablepictureinpicture
                                        controlslist="nodownload noplaybackrate noremoteplayback"
                                    >
                                        <source src="${videoPath}">
                                    </video>
                                </div>`
						} else if (item.imageFile) {
							const imagePath = `https://cdn.lovepal.net${item.imageFile}`
							mediaMarkup = `
                                <div class="feed-media">
                                    <img 
                                        class="feed-image"
                                        id="image-${index}"
                                        src="${imagePath}"
                                        alt="${item.character?.name || 'AI Image'}"
                                        draggable="false"
                                    />
                                </div>`
						} else {
							mediaMarkup = `
                                <div class="feed-media">
                                    <div class="video-placeholder">
                                        <div class="video-icon">âš ï¸</div>
                                        <div>No media available</div>
                                    </div>
                                </div>`
						}

						feedItem.innerHTML = mediaMarkup
						feedScrollArea.appendChild(feedItem)

						if (item.videoFile) {
							const video = feedItem.querySelector(`#video-${index}`)
							const placeholder = feedItem.querySelector(`#placeholder-${index}`)

							// å¼ºåˆ¶è§†é¢‘é™éŸ³å¹¶ç¦ç”¨éŸ³é¢‘æ§åˆ¶
							video.muted = true
							video.volume = 0

							video.addEventListener('loadeddata', function () {
								placeholder.style.display = 'none'
								video.style.display = 'block'

								// ç¡®ä¿è§†é¢‘ä¿æŒé™éŸ³
								video.muted = true
								video.volume = 0

								console.log(`âœ… è§†é¢‘ ${index + 1} (${item.videoFile}) ä» https://cdn.lovepal.net æˆåŠŸåŠ è½½`)
							})

							video.addEventListener('error', function (e) {
								console.error(`âŒ è§†é¢‘ ${index + 1} (${item.videoFile}) åŠ è½½å¤±è´¥:`, e)
								console.log('æ˜¾ç¤ºå ä½ç¬¦æ›¿ä»£')
								// å ä½ç¬¦ä¿æŒå¯è§
							})

							// åŒæ—¶è®°å½•è§†é¢‘è·¯å¾„ä»¥ä¾¿è°ƒè¯•
							console.log(`ğŸ¬ å°è¯•åŠ è½½: https://cdn.lovepal.net${item.videoFile}`)

							// ä½¿è§†é¢‘å¯ç‚¹å‡» - å¯¼èˆªåˆ° feed åŒæ—¶é˜²æ­¢æš‚åœ
							video.addEventListener('click', function (e) {
								e.preventDefault()
								e.stopPropagation()
								// å¯¼èˆªåˆ° feed
								const clickUrl = `https://loveone.wiki?utm_source=${encodeURIComponent(ref)}&utm_medium=feed-video&utm_campaign=${encodeURIComponent(variant)}&utm_content=${encodeURIComponent(utm_content)}`
								window.open(clickUrl, '_blank')
							})

							// é˜²æ­¢é€šè¿‡å…¶ä»–äº‹ä»¶æš‚åœ
							video.addEventListener('pause', function (e) {
								// ä»…åœ¨è§†é¢‘ä¸å¯è§æ—¶å…è®¸æš‚åœï¼ˆäº¤é›†è§‚å¯Ÿå™¨å¤„ç†æ­¤æƒ…å†µï¼‰
								if (currentVideoIndex === index) {
									video.play()
								}
							})

							// ç¦ç”¨è§†é¢‘ä¸Šçš„ä¸Šä¸‹æ–‡èœå•
							video.addEventListener('contextmenu', function (e) {
								e.preventDefault()
							})

							// ç¡®ä¿å³ä½¿ç”¨æˆ·å°è¯•å–æ¶ˆé™éŸ³ï¼Œè§†é¢‘ä¹Ÿä¿æŒé™éŸ³
							video.addEventListener('volumechange', function () {
								if (!video.muted || video.volume > 0) {
									video.muted = true
									video.volume = 0
								}
							})
						}
					})
				}

				// å¤„ç†è§†é¢‘äº¤é›†å’Œè‡ªåŠ¨æ’­æ”¾
				function setupVideoIntersection() {
					const options = {
						threshold: 0.7,
						root: document.getElementById('feedScrollArea'),
					}

					const observer = new IntersectionObserver((entries) => {
						entries.forEach((entry) => {
							const index = parseInt(entry.target.dataset.index)
							const video = document.getElementById(`video-${index}`)

							if (!video) {
								return
							}

							if (entry.isIntersecting) {
								currentVideoIndex = index
								video.play()

								// è¿½è¸ªè§†é¢‘è§‚çœ‹å¹¶æ£€æŸ¥å¼¹çª—è§¦å‘æ¡ä»¶
								if (!videosViewed.has(index)) {
									videosViewed.add(index)
									console.log(`è§†é¢‘ ${index + 1} å·²è§‚çœ‹ã€‚å·²è§‚çœ‹è§†é¢‘æ€»æ•°:`, videosViewed.size)

									// åœ¨ç¬¬ä¸€æ¬¡äº¤äº’æ—¶éšè—æ»‘åŠ¨æŒ‡ç¤ºå™¨
									if (!hasInteracted && index > 0) {
										hasInteracted = true
										hideSwipeIndicator()
									}

									// è§‚çœ‹ 3 ä¸ªä¸åŒè§†é¢‘åæ˜¾ç¤ºå¼¹çª—
									if (videosViewed.size >= 3 && !hasShownPopup) {
										hasShownPopup = true
										setTimeout(() => {
											document.getElementById('popupOverlay').classList.add('show')
										}, 500) // çŸ­æš‚å»¶è¿Ÿä»¥æ”¹å–„ç”¨æˆ·ä½“éªŒ
									}
								}
							} else {
								if (video) {
									video.pause()
								}
							}
						})
					}, options)

					document.querySelectorAll('.feed-item').forEach((item) => {
						observer.observe(item)
					})
				}

				// éšè—æ»‘åŠ¨æŒ‡ç¤ºå™¨
				function hideSwipeIndicator() {
					const swipeIndicator = document.getElementById('swipeIndicator')
					if (swipeIndicator) {
						swipeIndicator.classList.add('hidden')
						console.log('ç”¨æˆ·äº¤äº’åéšè—æ»‘åŠ¨æŒ‡ç¤ºå™¨')
					}
				}

				// ç®€å•çš„æ•æ‰åˆ°ä¸‹ä¸€ä¸ªå¯¼èˆª
				function navigateToVideo(direction) {
					const now = Date.now()

					// å¤šå±‚ä¿æŠ¤
					if (isNavigating) return
					if (now - lastNavigationTime < 800) return // å¯¼èˆªä¹‹é—´æœ€å°‘ 800ms

					let targetIndex = currentVideoIndex

					if (direction === 'next' && currentVideoIndex < feedItems.length - 1) {
						targetIndex = currentVideoIndex + 1
					} else if (direction === 'prev' && currentVideoIndex > 0) {
						targetIndex = currentVideoIndex - 1
					}

					if (targetIndex === currentVideoIndex) return

					// ç«‹å³é”å®šå¹¶æ›´æ–°ç´¢å¼•ä»¥é˜²æ­¢åŒé‡è§¦å‘
					isNavigating = true
					lastNavigationTime = now
					currentVideoIndex = targetIndex

					const feedScrollArea = document.getElementById('feedScrollArea')
					const itemHeight =
						dynamicFeedHeight ||
						document.querySelector('.feed-item')?.getBoundingClientRect().height ||
						244
					const targetScrollTop = targetIndex * itemHeight // æ¯ä¸ªè§†é¢‘çš„é«˜åº¦

					feedScrollArea.scrollTo({
						top: targetScrollTop,
						behavior: 'smooth',
					})

					console.log(`ğŸ“± å¯¼èˆªåˆ°è§†é¢‘ ${targetIndex + 1} (ä¹‹å‰æ˜¯ ${currentVideoIndex})`)

					// æ›´é•¿çš„é”å®šä»¥é˜²æ­¢åŠ¨é‡/åŒé‡è§¦å‘
					setTimeout(() => {
						isNavigating = false
						console.log(`ğŸ”“ å¯¼èˆªåœ¨è§†é¢‘ ${currentVideoIndex + 1} å¤„è§£é”`)
					}, 1000)
				}

				// å¤„ç†ä»»ä½•æ»šåŠ¨/æ»šè½®äº‹ä»¶ - æ•æ‰åˆ°ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ª
				function handleScrollEvent(e) {
					e.preventDefault()
					e.stopPropagation()

					if (isNavigating) {
						console.log(`ğŸš« å¯¼èˆªè¢«é˜»æ­¢ - æ­£åœ¨è¿›è¡Œä¸­`)
						return false
					}

					const delta = e.deltaY || e.detail || e.wheelDelta
					console.log(`ğŸ–±ï¸ æ£€æµ‹åˆ°æ»šåŠ¨: delta=${delta}, å½“å‰è§†é¢‘=${currentVideoIndex + 1}`)

					if (Math.abs(delta) < 10) return false // å¿½ç•¥å¾®å°ç§»åŠ¨

					if (delta > 0) {
						navigateToVideo('next')
					} else if (delta < 0) {
						navigateToVideo('prev')
					}

					return false
				}

				// åŸºäºè§†é¢‘çš„è¿½è¸ªå’Œå—æ§å¯¼èˆª
				function trackScroll() {
					const feedScrollArea = document.getElementById('feedScrollArea')

					// æ·»åŠ æ»šè½®äº‹ä»¶ç›‘å¬å™¨ä»¥è¿›è¡Œå—æ§å¯¼èˆª
					feedScrollArea.addEventListener('wheel', handleScrollEvent, { passive: false })

					// æ·»åŠ ç§»åŠ¨è®¾å¤‡è§¦æ‘¸æ”¯æŒ
					let touchStartY = 0
					let touchEndY = 0
					let touchMoved = false

					feedScrollArea.addEventListener(
						'touchstart',
						function (e) {
							if (!hasInteracted) {
								hasInteracted = true
								hideSwipeIndicator()
							}
							touchStartY = e.touches[0].clientY
							touchMoved = false
						},
						{ passive: false }
					)

					feedScrollArea.addEventListener(
						'touchmove',
						function (e) {
							touchMoved = true
							// åªæœ‰åœ¨æœ‰æ˜¾è‘—ç§»åŠ¨ï¼ˆæ»‘åŠ¨ï¼‰æ—¶æ‰é˜»æ­¢é»˜è®¤è¡Œä¸º
							const currentY = e.touches[0].clientY
							const diff = Math.abs(touchStartY - currentY)
							if (diff > 10) {
								e.preventDefault()
								e.stopPropagation()
							}
						},
						{ passive: false }
					)

					feedScrollArea.addEventListener(
						'touchend',
						function (e) {
							if (isNavigating) {
								console.log(`ğŸš« è§¦æ‘¸å¯¼èˆªè¢«é˜»æ­¢ - æ­£åœ¨è¿›è¡Œä¸­`)
								return
							}

							touchEndY = e.changedTouches[0].clientY
							const touchDiff = touchStartY - touchEndY
							const minSwipeDistance = 50

							console.log(`ğŸ‘† è§¦æ‘¸: start=${touchStartY}, end=${touchEndY}, diff=${touchDiff}`)

							if (Math.abs(touchDiff) > minSwipeDistance) {
								if (touchDiff > 0) {
									// å‘ä¸Šæ»‘åŠ¨ï¼ˆä¸‹ä¸€ä¸ªè§†é¢‘ï¼‰
									console.log(`ğŸ‘† æ£€æµ‹åˆ°å‘ä¸Šæ»‘åŠ¨ - å‰å¾€ä¸‹ä¸€ä¸ªè§†é¢‘`)
									navigateToVideo('next')
								} else {
									// å‘ä¸‹æ»‘åŠ¨ï¼ˆä¸Šä¸€ä¸ªè§†é¢‘ï¼‰
									console.log(`ğŸ‘† æ£€æµ‹åˆ°å‘ä¸‹æ»‘åŠ¨ - å‰å¾€ä¸Šä¸€ä¸ªè§†é¢‘`)
									navigateToVideo('prev')
								}
							} else {
								console.log(`ğŸ‘† è§¦æ‘¸å¤ªå°: ${Math.abs(touchDiff)}px < ${minSwipeDistance}px - è§†ä¸ºç‚¹å‡»`)
								// å¤„ç†ç‚¹å‡» - æ£€æŸ¥æ˜¯å¦ç‚¹å‡»äº†äº¤äº’å…ƒç´ 
								const target = document.elementFromPoint(e.changedTouches[0].clientX, e.changedTouches[0].clientY)

								if (target && !target.closest('.clickable-element') && !target.closest('.feed-header') && !target.closest('.popup-overlay')) {
									// ç‚¹å‡»èƒŒæ™¯ - æ‰“å¼€ feed
									console.log(`ğŸ‘† æ£€æµ‹åˆ°èƒŒæ™¯ç‚¹å‡» - æ‰“å¼€ feed`)
									const clickUrl = `https://loveone.wiki?utm_source=${encodeURIComponent(ref)}&utm_medium=feed-background&utm_campaign=${encodeURIComponent(variant)}&utm_content=${encodeURIComponent(content)}`
									window.open(clickUrl, '_blank')
								}
							}
						},
						{ passive: false }
					)

					// é˜»æ­¢é»˜è®¤æ»šåŠ¨è¡Œä¸º
					feedScrollArea.addEventListener('scroll', function (e) {
						if (!hasInteracted) {
							hasInteracted = true
							hideSwipeIndicator()
						}
					})

					// é¼ æ ‡äº¤äº’
					feedScrollArea.addEventListener(
						'mousedown',
						function () {
							if (!hasInteracted) {
								hasInteracted = true
								hideSwipeIndicator()
							}
						},
						{ once: true }
					)

					console.log('åŸºäºè§†é¢‘çš„è¿½è¸ªå·²å¯ç”¨ï¼šè§‚çœ‹ 3 ä¸ªç‹¬ç‰¹è§†é¢‘åæ˜¾ç¤ºå¼¹çª—')
					console.log('å—æ§å¯¼èˆªå·²å¯ç”¨ï¼šæ¯æ¬¡ä¸€ä¸ªè§†é¢‘ï¼Œ800ms èŠ‚æµ')
				}

				// æ“ä½œå¤„ç†å‡½æ•°
				window.handleLove = function (index) {
					const lovesElement = document.getElementById(`loves-${index}`)
					const currentLoves = parseInt(lovesElement.textContent.replace('k', '000').replace('.', ''))
					// ä¸å¢åŠ ï¼Œåªæ˜¾ç¤ºåŠ¨ç”»ï¼Œå› ä¸ºæˆ‘ä»¬æ­£åœ¨å¯¼èˆªç¦»å¼€

					// æ·»åŠ çˆ±å¿ƒåŠ¨ç”»
					const loveIcon = lovesElement.previousElementSibling
					loveIcon.style.transform = 'scale(1.3)'
					setTimeout(() => {
						loveIcon.style.transform = 'scale(1)'
					}, 200)
				}

				window.openPhotos = function (index) {
					if (feedItems[index]) {
						const photosUrl = `https://loveone.wiki/${feedItems[index].photosPath}?utm_source=${encodeURIComponent(ref)}&utm_medium=feed-character&utm_campaign=${encodeURIComponent(variant)}&utm_content=${encodeURIComponent(utm_content)}`
						window.open(photosUrl, '_blank')
					}
				}

				// å¤„ç†ç‚¹å‡»
				function setupClickHandlers() {
					const popupButton = document.getElementById('popupButton')
					const feedContainer = document.getElementById('feedContainer')
					const feedHeader = document.getElementById('feedHeader')
					const feedScrollArea = document.getElementById('feedScrollArea')

					let clickStartTime = 0
					let clickStartY = 0

					// Feed å¤´éƒ¨ç‚¹å‡»ï¼ˆlogo + faviconï¼‰
					if (feedHeader) {
						feedHeader.addEventListener('click', function (e) {
							e.stopPropagation()
							const clickUrl = `https://loveone.wiki?utm_source=${encodeURIComponent(ref)}&utm_medium=feed-header&utm_campaign=${encodeURIComponent(variant)}&utm_content=${encodeURIComponent(utm_content)}`
							window.open(clickUrl, '_blank')
						})
					}

					// å¼¹çª—æŒ‰é’®ç‚¹å‡»
					if (popupButton) {
						popupButton.addEventListener('click', function (e) {
							e.stopPropagation()
							const clickUrl = `https://loveone.wiki?utm_source=${encodeURIComponent(ref)}&utm_medium=feed-popup&utm_campaign=${encodeURIComponent(variant)}&utm_content=${encodeURIComponent(utm_content)}`
							window.open(clickUrl, '_blank')
						})
					}

					// Feed æ»šåŠ¨åŒºåŸŸçš„èƒŒæ™¯ç‚¹å‡»å¤„ç†å‡½æ•°
					if (feedScrollArea) {
						feedScrollArea.addEventListener('mousedown', function (e) {
							clickStartTime = Date.now()
							clickStartY = e.clientY
						})

						feedScrollArea.addEventListener('click', function (e) {
							// æ£€æŸ¥è¿™æ˜¯å¦æ˜¯å¿«é€Ÿç‚¹å‡»ï¼ˆä¸æ˜¯æ‹–æ‹½/æ»šåŠ¨ï¼‰
							const clickDuration = Date.now() - clickStartTime
							if (clickDuration > 300) return // å¤ªé•¿ï¼Œå¯èƒ½æ˜¯æ‹–æ‹½

							// å¦‚æœç‚¹å‡»äº†äº¤äº’å…ƒç´ æˆ–è§†é¢‘ï¼ˆè§†é¢‘æœ‰è‡ªå·±çš„å¤„ç†å‡½æ•°ï¼‰ï¼Œåˆ™ä¸è§¦å‘
							if (e.target.closest('.clickable-element') || e.target.closest('.feed-header') || e.target.closest('.popup-overlay') || e.target.closest('.feed-video')) {
								return
							}

							const clickUrl = `https://loveone.wiki?utm_source=${encodeURIComponent(ref)}&utm_medium=feed-background&utm_campaign=${encodeURIComponent(variant)}&utm_content=${encodeURIComponent(utm_content)}`
							window.open(clickUrl, '_blank')
						})
					}

					// å®¹å™¨ç‚¹å‡»ï¼ˆå›é€€ï¼‰
					feedContainer.addEventListener('click', function (e) {
						// ä»…åœ¨ç‚¹å‡»å®¹å™¨èƒŒæ™¯æ—¶è§¦å‘
						if (e.target === feedContainer) {
							const clickUrl = `https://loveone.wiki?utm_source=${encodeURIComponent(ref)}&utm_medium=feed-container&utm_campaign=${encodeURIComponent(variant)}&utm_content=${encodeURIComponent(utm_content)}`
							window.open(clickUrl, '_blank')
						}
					})
				}

				// åˆå§‹åŒ– feed
				function initializeFeed() {
					try {
						console.log('ğŸš€ å¼€å§‹ feed åˆå§‹åŒ–...')

						if (allFeedItems.length === 0) {
							console.error('âŒ æ²¡æœ‰å¯ç”¨çš„ feed æ•°æ® - ä¸­æ­¢åˆå§‹åŒ–')
							return
						}

						console.log(`âœ… Feed æ•°æ®å‡†å¤‡å°±ç»ªï¼ŒåŒ…å« ${allFeedItems.length} ä¸ªé¡¹ç›®`)

						// æ ¹æ® URL å‚æ•°é€‰æ‹©å•ä¸ªå±•ç¤ºé¡¹ï¼ˆä¼˜å…ˆ handleï¼Œå…¶æ¬¡ idï¼‰
						const requestedKeyRaw = urlParams.get('item') || urlParams.get('handle') || urlParams.get('id')
						const defaultHandle = 'undress'

						let selectedItem = null

						if (requestedKeyRaw) {
							const requestedKey = requestedKeyRaw.toLowerCase()
							selectedItem = allFeedItems.find(
								(item) =>
									(item.handle && item.handle.toLowerCase() === requestedKey) ||
									String(item.id) === requestedKeyRaw
							)
						}

						if (!selectedItem) {
							selectedItem =
								allFeedItems.find((item) => item.handle && item.handle.toLowerCase() === defaultHandle) ||
								allFeedItems[0]
						}

						if (!selectedItem) {
							console.error('âŒ æœªæ‰¾åˆ°æœ‰æ•ˆçš„ feed é¡¹ç›® - ä¸­æ­¢åˆå§‹åŒ–')
							return
						}

						feedItems = [selectedItem]

						console.log(`ğŸ¯ é€‰å®šå±•ç¤ºé¡¹ç›®: ${selectedItem.character?.name || selectedItem.handle || selectedItem.id}`)
						console.log(
							`ğŸ“¼ åª’ä½“ç±»å‹: ${
								selectedItem.videoFile ? 'video' : selectedItem.imageFile ? 'image' : 'unknown'
							}`
						)

						console.log('ğŸ—ï¸ ç”Ÿæˆ feed å†…å®¹...')
						applyDynamicSize()
						generateFeedContent()

						console.log('ğŸ‘ï¸ è®¾ç½®è§†é¢‘äº¤é›†...')
						if (feedItems.some((item) => item.videoFile)) {
							setupVideoIntersection()
						}

						console.log('ğŸ–±ï¸ è®¾ç½®æ»šåŠ¨è¿½è¸ª...')
						trackScroll()

						console.log('ğŸ”— è®¾ç½®ç‚¹å‡»å¤„ç†å‡½æ•°...')
						setupClickHandlers()

						console.log('âœ… Feed åˆå§‹åŒ–æˆåŠŸï¼')
						console.log('ğŸ“Š é…ç½®:', { site, ref, variant })
						console.log('ğŸ–¼ï¸ å½“å‰å±•ç¤ºä¸ºå•æ¡å†…å®¹ã€‚')
					} catch (error) {
						console.error('ğŸ’¥ Feed åˆå§‹åŒ–å¤±è´¥:', error)
						console.error('å †æ ˆè·Ÿè¸ª:', error.stack)
					}
				}

				// é¡µé¢åŠ è½½æ—¶å¯åŠ¨
				if (document.readyState === 'loading') {
					document.addEventListener('DOMContentLoaded', initializeFeed)
				} else {
					initializeFeed()
				}
			})()
		</script>
	</body>
</html>
